---
title: "Lab_10_Metagenomics_MBI3100A_2022_Assignment"
output:
  pdf_document: default
date: "2022-11-12"
editor_options:
  markdown:
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r}
# clear the R environment
rm(list = ls())
```

# Install required libraries

Installing these libraries may take some time.
Try to update all other dependencies when prompted (type "a" and enter).

```{r}

if (!require("BiocManager")) install.packages("BiocManager")

if (!require("phyloseq")) BiocManager::install("phyloseq")

if (!require("tidyverse")) install.packages("tidyverse")

if (!require("DT")) install.packages("DT")

if (!require("dendextend")) install.packages("dendextend")

```

# Load Libraries

```{r}
library(phyloseq)
library(ggplot2)
library(dplyr)
library(DT)
library(dendextend)
```

# Data import

### Questin 1: Import the three files named as 'GP_sp_assignment_otu_table_df.csv', 'GP_sp_assignment_sample_data_df.csv', and 'GP_sp_assignment_tax_table_df.csv' and make a phyloseq object named 'asgmt_physeq'? (2 mark)

Please provide the correct file/folder path

```{r}
GP_sp_assignment_otu_table = read.table("./assignment_files/GP_sp_assignment_otu_table_df.csv",
           sep = "\t",
           header =  T,
           row.names = "otus")
my_OTU_table = otu_table(GP_sp_assignment_otu_table, taxa_are_rows = TRUE)
GP_sp_assignment_sample_data = read.table("./assignment_files/GP_sp_assignment_sample_data_df.csv",
           sep = "\t", header =  T,
           row.names = "sampleid")
my_Sample_data = sample_data(GP_sp_assignment_sample_data)
GP_sp_assignment_tax_table = read.table("./assignment_files/GP_sp_assignment_tax_table_df.csv",
           sep = "\t",
           header =  T,
           row.names = "otus")
my_tax_table = tax_table(as.matrix(GP_sp_assignment_tax_table)) 

asgmt_physeq = phyloseq(my_OTU_table, my_Sample_data, my_tax_table)
```

### Print asgmt_physeq

```{r}
print(asgmt_physeq)
```

### Question 2: How many taxa, samples, and sample vairables are there in asgmt_physeq? (1mark)

``` md
```

### Question 3: List the catagories present in the sample variable "SampleOrigin". (1 mark)

```{r}
sample_data(asgmt_physeq)$SampleOrigin %>% as.factor %>% levels()
```

### Question 4: Generate a bar plot for sample vs abudance and facet it for the catagories in SampleOrigin (1 mark)

```{r}
 p = plot_bar(asgmt_physeq, x= "Phylum", fill = "Phylum", facet_grid=SampleOrigin~.)
 p + theme(legend.position="none") + geom_bar(stat = "identity")
```

### Question 5: Based on the plot generated in question 4, name all the phylum which big difference in abundance between "Feces" and "Freshwater" samples? (1 mark)

``` md
```

### Transform the absolute abundance into relative abundance and filter the taxa which have mean relative abundance less than 0.0001

```{r}
# To convert to relative abundance
asgmt_physeq_r  = transform_sample_counts(asgmt_physeq, function(x) x / sum(x) )
# Keep the taxa which have a mean values at least 0.0001
asgmt_physeq_rf = filter_taxa(asgmt_physeq_r, function(x) mean(x) > 0.0001, TRUE)
asgmt_physeq_rf
```

### Question 6: How many taxa are left after the above filtering?

``` md
```

#Extract OTU table

```{r}

ps_rel_otu = data.frame(phyloseq::otu_table(asgmt_physeq))

ps_rel_otu = t(ps_rel_otu) # transpose the table (required by vegdist )
```

#### Options availabe for hclust

```{r}
?hclust
```

### Question 7: Generate a Hierarchical clustering plot
